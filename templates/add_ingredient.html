{% extends "base.html" %}

{% block title %}é£Ÿæè¿½åŠ  - ãƒ¬ã‚·ãƒ”æ¤œç´¢ã‚¢ãƒ—ãƒª{% endblock %}
{% block page_title %}é£Ÿæè¿½åŠ {% endblock %}

{% block extra_css %}
<style>
   

    .add-form-card .form-label {
        color: rgb(0, 0, 0);
    }
    
    .add-form-card input,
    .add-form-card select,
    .add-form-card .form-control {
        border: none;
        border-radius: 8px;
        padding: 12px;
        font-size: 14px;
    }
    
    .add-form-card .btn {
        border: none;
        background: rgba(255,255,255,0.2);
        color: white;
        font-weight: 600;
        padding: 12px 20px;
    }
    
    .add-form-card .btn:hover {
        background: rgba(255,255,255,0.3);
    }
    
    .add-form-card label {
        color: white;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .quick-add-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 8px;
        margin-bottom: 20px;
    }
    
    .quick-add-btn {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        text-decoration: none;
        color: #495057;
        font-size: 0.8rem;
        transition: all 0.3s;
    }
    
    .quick-add-btn:hover {
        border-color: #007bff;
        color: #007bff;
        background: rgba(0,123,255,0.1);
    }
    
    .tips-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
    }
    
    .tip-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
    }
    
    .tip-icon {
        font-size: 1.2rem;
        margin-right: 10px;
        margin-top: 2px;
    }
    
    .recent-ingredients {
        max-height: 200px;
        overflow-y: auto;
    }
    
    .selected-tags-container {
        min-height: 40px;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
    }

    .selected-tag {
        background: #007bff;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .tag-remove {
        cursor: pointer;
        font-weight: bold;
    }

    .tag-suggestions {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 8px;
    }

    .tag-btn {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 4px 8px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .tag-btn:hover {
        background: #007bff;
        color: white;
    }

    .recent-item {
        background: #f8f9fa;
        border-radius: 6px;
        padding: 8px 12px;
        margin-bottom: 5px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .recent-item:hover {
        background: #e9ecef;
    }

    /* ãƒ¡ã‚¤ãƒ³ã®ç™»éŒ²ãƒœã‚¿ãƒ³ã«ç«‹ä½“æ„Ÿã‚’è¿½åŠ  */
    .add-form-card .btn-light {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 
                    0 1px 3px rgba(0, 0, 0, 0.08);
        transform: translateY(0);
        transition: all 0.2s ease;
        background: linear-gradient(to bottom, #ffffff, #f8f9fa);
        border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .add-form-card .btn-light:hover {
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15), 
                    0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
        background: linear-gradient(to bottom, #ffffff, #ffffff);
    }
    
    .add-form-card .btn-light:active {
        box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1) inset;
        transform: translateY(1px);
    }

    /* æ•°é‡èª¿æ•´ãƒœã‚¿ãƒ³ã«ç«‹ä½“æ„Ÿã‚’è¿½åŠ  */
    .add-form-card .btn-outline-light {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(0);
        transition: all 0.15s ease;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(255, 255, 255, 0.5);
        color: black;
    }
    
    .add-form-card .btn-outline-light:hover {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        transform: translateY(-1px);
        background: rgba(255, 255, 255, 1);
        color: black;
    }
    
    .add-form-card .btn-outline-light:active {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;
        transform: translateY(1px);
    }

    /* ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šãƒœã‚¿ãƒ³ã«ç«‹ä½“æ„Ÿã‚’è¿½åŠ ï¼ˆbase.htmlã®ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ */
    .btn-sm.btn-outline-light {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        transform: translateY(0);
        transition: all 0.2s ease;
        background: white;
        border: 1px solid rgba(255, 255, 255, 0.5);
        color: black;
        font-weight: 500;
    }
    
    .btn-sm.btn-outline-light:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.8);
        color: white;
    }
    
    .btn-sm.btn-outline-light:active {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;
        transform: translateY(0);
        background: rgba(255, 255, 255, 0.15);
    }

    /* ã‚ˆãä½¿ã†é£Ÿæãƒœã‚¿ãƒ³ã«ã‚‚ç«‹ä½“æ„Ÿã‚’è¿½åŠ  */
    .quick-add-btn {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        transform: translateY(0);
        transition: all 0.2s ease;
    }
    
    .quick-add-btn:hover {
        box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2);
        transform: translateY(-2px);
    }
    
    .quick-add-btn:active {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;
        transform: translateY(0);
    }

    /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã«ã‚‚ç«‹ä½“æ„Ÿã‚’è¿½åŠ  */
    .section-card .btn {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transform: translateY(0);
        transition: all 0.2s ease;
    }
    
    .section-card .btn:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
    }
    
    .section-card .btn:active {
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) inset;
        transform: translateY(1px);
    }

    /* ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ– */
    .btn-light span {
        display: inline-block;
        transition: transform 0.1s ease;
    }
    
    .btn-light:active span {
        transform: scale(0.98);
    }

.add-form-card {
        background: linear-gradient(135deg, #28a745, #20c997) !important;
        color: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
    }

 .add-form-card {
        background: linear-gradient(135deg, #28a745, #20c997) !important;
        color: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 20px;
    }
/* æœªè¨­å®šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šã®ãƒ†ã‚­ã‚¹ãƒˆã®è‰²ã¨ã‚µã‚¤ã‚º */
.add-form-card small,
.add-form-card .text-white-50 {
    color: rgb(255, 255, 255) !important;
    font-size: 0.9rem !important;
}

</style>
{% endblock %}

{% block content %}
<!-- ãƒ¡ã‚¤ãƒ³è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="add-form-card">
    <div class="section-title text-black">â• æ–°ã—ã„é£Ÿæã‚’è¿½åŠ </div>
    <form method="POST">
        <div class="row g-3">
            <div class="col-12">
                <label for="ingredient" class="form-label">é£Ÿæå</label>
                <input type="text" name="ingredient" id="ingredient" class="form-control" 
                       placeholder="ä¾‹: ã«ã‚“ã˜ã‚“ã€ç‰›è‚‰ã€åµãªã©" required autocomplete="off" autofocus>
            </div>
            
            <div class="col-md-6">
                <label for="expiry_date" class="form-label">è³å‘³æœŸé™</label>
                <input type="date" name="expiry_date" id="expiry_date" class="form-control">
                <small class="text-white-50">æœªè¨­å®šã§ã‚‚ç™»éŒ²ã§ãã¾ã™</small>
            </div>
            
            <div class="col-md-6">
                <label for="quantity" class="form-label">æ•°é‡</label>
                <div class="input-group">
                    <button type="button" class="btn btn-outline-light text-dark" onclick="changeQuantity(-1)">âˆ’</button>
                    <input type="number" name="quantity" id="quantity" value="1" min="1" max="99" class="form-control text-center">
                    <button type="button" class="btn btn-outline-light text-dark" onclick="changeQuantity(1)">+</button>
                </div>
            </div>

            <div class="col-md-6">
                <label for="category" class="form-label">ã‚«ãƒ†ã‚´ãƒª</label>
                <select name="category" id="category" class="form-control" required>
                    <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="é‡èœ">é‡èœ</option>
                    <option value="è‚‰é¡">è‚‰é¡</option>
                    <option value="é­šä»‹é¡">é­šä»‹é¡</option>
                    <option value="ä¹³è£½å“">ä¹³è£½å“</option>
                    <option value="ç©€é¡">ç©€é¡</option>
                    <option value="èª¿å‘³æ–™">èª¿å‘³æ–™</option>
                    <option value="ãã®ä»–">ãã®ä»–</option>
                </select>
            </div>
            
            <div class="col-12">
                <button type="submit" class="btn btn-light w-100">
                    ğŸ“¦ <span style="color: black;">é£Ÿæã‚’ç™»éŒ²ã™ã‚‹</span>
                </button>
            </div>
        </div>
    </form>
</div>

<!-- ã‚ˆãä½¿ã†é£Ÿæï¼ˆã‚¯ã‚¤ãƒƒã‚¯è¿½åŠ ï¼‰ -->
<div class="section-card">
    <div class="section-title">âš¡ ã‚ˆãä½¿ã†é£Ÿæ</div>
    <p class="text-muted small mb-3">ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨å…¥åŠ›æ¬„ã«è‡ªå‹•å…¥åŠ›ï¼†ã‚«ãƒ†ã‚´ãƒªã‚‚è¨­å®šã•ã‚Œã¾ã™</p>
    <div class="quick-add-buttons">
        <button type="button" class="quick-add-btn" onclick="quickAdd('ã«ã‚“ã˜ã‚“')">ğŸ¥•<br>ã«ã‚“ã˜ã‚“</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('ãŸã¾ã­ã')">ğŸ§…<br>ãŸã¾ã­ã</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('ã˜ã‚ƒãŒã„ã‚‚')">ğŸ¥”<br>ã˜ã‚ƒãŒã„ã‚‚</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('ã‚­ãƒ£ãƒ™ãƒ„')">ğŸ¥¬<br>ã‚­ãƒ£ãƒ™ãƒ„</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('è±šè‚‰')">ğŸ¥“<br>è±šè‚‰</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('é¶è‚‰')">ğŸ—<br>é¶è‚‰</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('åµ')">ğŸ¥š<br>åµ</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('ç‰›ä¹³')">ğŸ¥›<br>ç‰›ä¹³</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('è±†è…')">ğŸ²<br>è±†è…</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('ã‚‚ã‚„ã—')">ğŸŒ±<br>ã‚‚ã‚„ã—</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('ãƒˆãƒãƒˆ')">ğŸ…<br>ãƒˆãƒãƒˆ</button>
        <button type="button" class="quick-add-btn" onclick="quickAdd('ç±³')">ğŸš<br>ç±³</button>
    </div>
</div>

<!-- ä¾¿åˆ©ãªæ©Ÿèƒ½ã¨ã‚³ãƒ„ -->
<div class="tips-card">
    <div class="section-title">ğŸ’¡ é£Ÿæç™»éŒ²ã®ã‚³ãƒ„</div>
    
    <div class="tip-item">
        <div class="tip-icon">ğŸ“…</div>
        <div>
            <strong>è³å‘³æœŸé™ã‚’è¨­å®š</strong><br>
            <small class="text-muted">æœŸé™ãŒè¿‘ã¥ãã¨è‡ªå‹•ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™</small>
        </div>
    </div>
    
    <div class="tip-item">
        <div class="tip-icon">ğŸ”¢</div>
        <div>
            <strong>æ­£ç¢ºãªæ•°é‡ã‚’å…¥åŠ›</strong><br>
            <small class="text-muted">ãƒ¬ã‚·ãƒ”æ¤œç´¢æ™‚ã«é©é‡ã‚’åˆ¤æ–­ã§ãã¾ã™</small>
        </div>
    </div>
    
    <div class="tip-item">
        <div class="tip-icon">âœï¸</div>
        <div>
            <strong>å…·ä½“çš„ãªåå‰ã§ç™»éŒ²</strong><br>
            <small class="text-muted">ã€Œè‚‰ã€ã‚ˆã‚Šã€Œè±šè‚‰ã€ã€Œé¶è‚‰ã€ã®æ–¹ãŒæ¤œç´¢ç²¾åº¦UP</small>
        </div>
    </div>
    
    <div class="tip-item">
        <div class="tip-icon">ğŸ“±</div>
        <div>
            <strong>ã¾ã¨ã‚ã¦ç™»éŒ²</strong><br>
            <small class="text-muted">è²·ã„ç‰©å¾Œã«ã¾ã¨ã‚ã¦ç™»éŒ²ã™ã‚‹ã¨åŠ¹ç‡çš„</small>
        </div>
    </div>
</div>

<!-- ä»Šã™ãã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="section-card">
    <div class="section-title">ğŸš€ æ¬¡ã«ã‚„ã£ã¦ã¿ã‚‹</div>
    <div class="d-grid gap-2 d-md-flex">
        <a href="{{ url_for('add_ingredient') }}" class="btn btn-success" onclick="document.getElementById('ingredient').focus();">
            ç¶šã‘ã¦è¿½åŠ 
        </a>
        <a href="{{ url_for('refrigerator') }}" class="btn btn-primary">
            å†·è”µåº«ã‚’ç¢ºèª
        </a>
        <a href="{{ url_for('search') }}" class="btn btn-outline-primary">
            ãƒ¬ã‚·ãƒ”æ¤œç´¢
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // æ•°é‡å¤‰æ›´ãƒœã‚¿ãƒ³
    function changeQuantity(delta) {
        const quantityInput = document.getElementById('quantity');
        let currentValue = parseInt(quantityInput.value) || 1;
        let newValue = currentValue + delta;
        
        if (newValue < 1) newValue = 1;
        if (newValue > 99) newValue = 99;
        
        quantityInput.value = newValue;
    }
    
    // é£Ÿæã¨ã‚«ãƒ†ã‚´ãƒªã®ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆè©³ç´°ç‰ˆï¼‰
    const ingredientCategories = {
        // é‡èœ
        'ã«ã‚“ã˜ã‚“': 'é‡èœ',
        'ãŸã¾ã­ã': 'é‡èœ', 
        'ã˜ã‚ƒãŒã„ã‚‚': 'é‡èœ',
        'ã‚­ãƒ£ãƒ™ãƒ„': 'é‡èœ',
        'ãƒˆãƒãƒˆ': 'é‡èœ',
        'ã‚‚ã‚„ã—': 'é‡èœ',
        'ãã‚…ã†ã‚Š': 'é‡èœ',
        'ãªã™': 'é‡èœ',
        'ãƒ”ãƒ¼ãƒãƒ³': 'é‡èœ',
        'ãƒ¬ã‚¿ã‚¹': 'é‡èœ',
        
        // è‚‰é¡
        'è±šè‚‰': 'è‚‰é¡',
        'é¶è‚‰': 'è‚‰é¡', 
        'ç‰›è‚‰': 'è‚‰é¡',
        'ã²ãè‚‰': 'è‚‰é¡',
        'ãƒ™ãƒ¼ã‚³ãƒ³': 'è‚‰é¡',
        'ãƒãƒ ': 'è‚‰é¡',
        
        // é­šä»‹é¡
        'ã•ã°': 'é­šä»‹é¡',
        'ã•ã‘': 'é­šä»‹é¡',
        'ã¾ãã‚': 'é­šä»‹é¡',
        'ãˆã³': 'é­šä»‹é¡',
        'ã„ã‹': 'é­šä»‹é¡',
        
        // ä¹³è£½å“
        'åµ': 'ä¹³è£½å“',
        'ç‰›ä¹³': 'ä¹³è£½å“',
        'ãƒã‚¿ãƒ¼': 'ä¹³è£½å“',
        'ãƒãƒ¼ã‚º': 'ä¹³è£½å“',
        'ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ': 'ä¹³è£½å“',
        
        // ç©€é¡
        'ç±³': 'ç©€é¡',
        'ãƒ‘ãƒ³': 'ç©€é¡',
        'ãƒ‘ã‚¹ã‚¿': 'ç©€é¡',
        'ã†ã©ã‚“': 'ç©€é¡',
        
        // èª¿å‘³æ–™
        'é†¤æ²¹': 'èª¿å‘³æ–™',
        'å‘³å™Œ': 'èª¿å‘³æ–™',
        'å¡©': 'èª¿å‘³æ–™',
        'ç ‚ç³–': 'èª¿å‘³æ–™',
        'ã‚µãƒ©ãƒ€æ²¹': 'èª¿å‘³æ–™',
        
        // ãã®ä»–
        'è±†è…': 'ãã®ä»–',
        'ç´è±†': 'ãã®ä»–'
    };

    function quickAdd(ingredientName) {
        const ingredientInput = document.getElementById('ingredient');
        const categorySelect = document.getElementById('category');
        
        // é£Ÿæåã‚’è¨­å®š
        ingredientInput.value = ingredientName;
        
        // è‡ªå‹•ã‚«ãƒ†ã‚´ãƒªè¨­å®š
        if (ingredientCategories[ingredientName]) {
            categorySelect.value = ingredientCategories[ingredientName];
            
            // ã‚«ãƒ†ã‚´ãƒªè¨­å®šã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            categorySelect.style.backgroundColor = '#d4edda';
            categorySelect.style.border = '2px solid #28a745';
            
            setTimeout(() => {
                categorySelect.style.backgroundColor = '';
                categorySelect.style.border = '';
            }, 1000);
        }
        
        // é£Ÿæåã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
        ingredientInput.style.backgroundColor = '#e3f2fd';
        setTimeout(() => {
            ingredientInput.style.backgroundColor = '';
        }, 500);
        
        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
        ingredientInput.focus();
    }

    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è³å‘³æœŸé™ã®åˆæœŸå€¤ã«è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    function setDefaultExpiry(days = 7) {
        const expiryInput = document.getElementById('expiry_date');
        const today = new Date();
        today.setDate(today.getDate() + days);
        expiryInput.value = today.toISOString().split('T')[0];
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('â• Add ingredient page loaded');
        
        const expiryInput = document.getElementById('expiry_date');
        const quickExpiryDiv = document.createElement('div');
        quickExpiryDiv.className = 'mt-1';
        quickExpiryDiv.innerHTML = `
            <small class="text-white-50">ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š: </small>
            <button type="button" class="btn btn-sm btn-outline-light me-1" onclick="setDefaultExpiry(3)">3æ—¥å¾Œ</button>
            <button type="button" class="btn btn-sm btn-outline-light me-1" onclick="setDefaultExpiry(7)">1é€±é–“</button>
            <button type="button" class="btn btn-sm btn-outline-light" onclick="setDefaultExpiry(14)">2é€±é–“</button>
        `;
        expiryInput.parentNode.appendChild(quickExpiryDiv);
    });

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãƒ­ã‚°
    document.querySelector('form').addEventListener('submit', function(e) {
        const ingredientName = document.getElementById('ingredient').value;
        const categoryName = document.getElementById('category').value;
        console.log('ğŸ“¦ Adding ingredient:', ingredientName, 'ã‚«ãƒ†ã‚´ãƒª:', categoryName);
    });
</script>
{% endblock %}